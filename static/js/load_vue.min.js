let time_list=[],stop_flag=!1,first_flag=!0;function get_dan_mu(e,a,b){$.getJSON("/get_dan_mu?room_id="+e,function(c){for(const d of c){let g=d.timeline;if(first_flag){for(const f of c)time_list.push(f.timeline);first_flag=!1}else-1===time_list.indexOf(g)&&(on_dan_mu(d,a,b),10<=time_list.length&&time_list.shift(),time_list.push(g))}console.log(time_list)})}function on_dan_mu(e,a,b){send_to_server(e.nickname,e.text,a,b)}
function on_wss(e,a,b){let c=e.data.uname;e=e.data.msg;stop_flag?send_to_server(c,e,a,b):console.log("stop\n"+c+": "+e)}
function send_to_server(e,a,b,c){console.log(e+": "+a);a=a.split("#")[0];a=a.split(" ");e=a.shift();console.log(e);console.log(a);if("\u70b9\u6b4c"===e||"."===e)console.log(!0),a=a.join(" "),a=a.split("&"),void 0===a[1]&&(a=a[0].split("\uff06")),console.log(a),e=$.trim(a[0]),a=$.trim(a[1]),console.log(e),console.log(a),$.get("/move_music?where_url="+c+"&url="+b+"&index=-1&music_name="+e+"&artist="+a)}let last=[],last_list=[],start_flag=0,scroll_flag=1;
function change_bili_scroll_flag(e){scroll_flag=e}
function load_for_bili_setting_vue(e,a){return new Vue({el:"#app",data:{music_info:[""],console_info:[""],c_num:0,m_num:0,url:e,where:a,music_mask:!1,mask1:!1,mask1_1:!1,mask2:!1,mask2_1:!1,mask2_2:!1,play_icon_flag:1,music_list:[],play_icon:["icon-list_play","icon-list_stop"]},methods:{start_dan_mu(){start_flag?($.get("/start_dan_mu?data=0&"+this.where+"="+this.url),$("#start_dan_mu").text("\u5f00\u59cb\u7edf\u8ba1"),start_flag=0):$.getJSON("/start_dan_mu?data=1&"+this.where+"="+this.url,function(b){"id"==
b.data?alert("\u4f60\u7684\u623f\u95f4\u5730\u5740\u8bbe\u7f6e\u6709\u8bef\uff01\n\u8bf7\u5728\u6b4c\u8bcd\u8bbe\u7f6e\u6216\u6b4c\u540d\u8bbe\u7f6e\u4e2d\u8bbe\u7f6e\u6b63\u786e\u7684\u623f\u95f4\u540d\u5e76\u63d0\u4ea4"):"key"==b.data?alert("\u8bf7\u68c0\u67e5\u8bbe\u7f6e\u5e76\u91cd\u65b0\u63d0\u4ea4\n(\u65e0\u8bba\u662f\u5426\u6539\u53d8\u8bbe\u7f6e\u90fd\u5e94\u8be5\u70b9\u51fb\u63d0\u4ea4\u6309\u94ae)"):($("#start_dan_mu").text("\u505c\u6b62\u7edf\u8ba1"),start_flag=1)})},sql_who_play(){const b=
$("[name='switch']:eq(0)").prop("checked");console.log(b);b?$.get("/play?where_url="+this.where+"_url&url="+this.url+"&where=who_play&data=0"):$.get("/play?where_url="+this.where+"_url&url="+this.url+"&where=who_play&data=1")},sql_play(){this.play_icon_flag=this.play_icon_flag?0:1;$.get("/play?where_url="+this.where+"_url&url="+this.url+"&where=play&data="+this.play_icon_flag)},sql_replay(){$.get("/play?where_url="+this.where+"_url&url="+this.url+"&where=replay&data=1")},sql_next(){$.get("/next_music?url="+
this.url+"&where="+this.where)},get_music_info(b){$.getJSON("/get_data?url="+this.url+"&where="+this.where,function(c){console.log(c);var d=c.data.music_name_list,g=c.data.who_play;const f=c.data.is_running;b.console_info=c.data.console_info;b.play_icon_flag=c.data.play_;try{var h=[d.shift()]}catch(k){h=[]}h.equals([void 0])&&(h=[]);g?$("[name='switch']:eq(0)").prop("checked",!1):$("[name='switch']:eq(0)").prop("checked",!0);f?($("#start_dan_mu").text("\u505c\u6b62\u7edf\u8ba1"),start_flag=1):($("#start_dan_mu").text("\u5f00\u59cb\u7edf\u8ba1"),
start_flag=0);d.equals(last_list)||(last_list=d,b.music_list=d);if(!h.equals(last)){last=h;c=last.equals([])||last.equals([["",""]])?'<li><span class="music-name">\u6682\u65e0\u6b4c\u66f2</span><span class="artist">\u6682\u65e0</span></li>':'<li><span class="music-name">'+h[0][0]+'</span><span class="artist">'+h[0][1]+"</span></li>";h=document.getElementById("u");d=h.childNodes;for(g=d.length-1;0<=g;g--)h.removeChild(d[g]);h.innerHTML=c}})},display_operation(b){$(b).css("display","flex")},hidden_operation(b){$(b).css("display",
"none")},sql_delete_bili(b,c,d,g,f){$.get("/del_music?where_url="+f+"_url&url="+g+"&music_name="+c+"&artist="+d);$(b).remove()},sql_move_bili_music(b,c,d,g,f,h){$.get("/move_music?where_url="+h+"_url&url="+f+"&music_name="+c+"&artist="+d+"&index="+g)}},computed:{console_info_change(){const {console_info:b}=this;console.log(b);return{}},music_info_change(){const {music_info:b}=this;console.log(b);return{}}},watch:{console_info_change(){this.c_num++;if(scroll_flag){let b=$("#console-info");b.animate({scrollTop:b.get(0).scrollHeight},
1E3)}},music_info_change(){this.m_num++}},created(){const b=this;$.getJSON("/get_data?url="+this.url+"&where="+this.where,function(c){b.play_icon_flag=c.data.play_});b.get_music_info(b);setInterval(()=>{b.get_music_info(b)},5E3)}})}function change_scroll_flag(e){scroll_flag=e}function sql_delete(e,a,b){$.get("/del_music?music_name="+a+"&artist="+b);$(e).remove()}function sql_move_music(e,a,b,c){$.get("/move_music?music_name="+a+"&artist="+b+"&index="+c)}function sql_replay(){}
function load_console(e){new Vue({el:".panel",data:{music_info:[""],console_info:[""],c_num:0,m_num:0},methods:{start_dan_mu(){start_flag?($.get("/start_dan_mu?data=0"),$("#start_dan_mu").text("\u5f00\u59cb\u7edf\u8ba1"),start_flag=0):$.getJSON("/start_dan_mu?data=1",function(a){"id"==a.data?alert("\u4f60\u7684\u623f\u95f4\u5730\u5740\u8bbe\u7f6e\u6709\u8bef\uff01\n\u8bf7\u5728\u6b4c\u8bcd\u8bbe\u7f6e\u6216\u6b4c\u540d\u8bbe\u7f6e\u4e2d\u8bbe\u7f6e\u6b63\u786e\u7684\u623f\u95f4\u540d\u5e76\u63d0\u4ea4"):
"key"==a.data?alert("\u8bf7\u68c0\u67e5\u8bbe\u7f6e\u5e76\u91cd\u65b0\u63d0\u4ea4\n(\u65e0\u8bba\u662f\u5426\u6539\u53d8\u8bbe\u7f6e\u90fd\u5e94\u8be5\u70b9\u51fb\u63d0\u4ea4\u6309\u94ae)"):($("#start_dan_mu").text("\u505c\u6b62\u7edf\u8ba1"),start_flag=1)})},sql_who_play(){const a=$("[name='switch']:eq(0)").prop("checked");console.log(a);a?$.get("/play?where=who_play&data=0"):$.get("/play?where=who_play&data=1")},sql_play(){$.get("/play?where=play&data="+this.play_icon_flag);this.play_icon_flag=
this.play_icon_flag?0:1},sql_replay(){$.get("/play?where=replay&data=1")},sql_next(){$.get("/next_music?url="+e+"&where=lyric")},get_music_info(a){$.getJSON("/get_data?url="+e+"&where=lyric",function(b){var c=b.data.music_name_list,d=b.data.who_play;const g=b.data.is_running;a.console_info=b.data.console_info;a.play_icon_flag=b.data.play_;try{var f=[c.shift()]}catch(h){f=[]}f.equals([void 0])&&(f=[]);d?$("[name='switch']:eq(0)").prop("checked",!1):$("[name='switch']:eq(0)").prop("checked",!0);g?($("#start_dan_mu").text("\u505c\u6b62\u7edf\u8ba1"),
start_flag=1):($("#start_dan_mu").text("\u5f00\u59cb\u7edf\u8ba1"),start_flag=0);if(!c.equals(last_list)){b=[];last_list=c;for(d=0;d<c.length;d++)b[d]=' <span class="music-name">'+c[d][0]+'</span><span class="artist">'+c[d][1]+'</span><button class="delete conform" onclick="sql_delete(\'#li'+d+"', '"+c[d][0]+"', '"+c[d][1]+'\')">\u5220\u9664</button><button class="delete conform" onclick="sql_move_music(\'#li'+d+"', '"+c[d][0]+"', '"+c[d][1]+'\', 1)">\u64ad\u653e</button><button class="delete conform" onclick="sql_move_music(\'#li'+
d+"', '"+c[d][0]+"', '"+c[d][1]+"', 2)\">\u4e0b\u4e00\u9996\u64ad\u653e</button>";a.music_info=b}if(!f.equals(last)){last=f;f=last.equals([])||last.equals([["",""]])?'<li><span class="music-name">\u6682\u65e0\u6b4c\u66f2</span><span class="artist">\u6682\u65e0</span></li>':'<li><span class="music-name">'+f[0][0]+'</span><span class="artist">'+f[0][1]+"</span></li>";c=document.getElementById("u");b=c.childNodes;for(d=b.length-1;0<=d;d--)c.removeChild(b[d]);c.innerHTML=f}})}},computed:{console_info_change(){const {console_info:a}=
this;console.log(a);return{}},music_info_change(){const {music_info:a}=this;console.log(a);return{}}},watch:{console_info_change(){this.c_num++;if(scroll_flag){let a=$("#console-info");a.animate({scrollTop:a.get(0).scrollHeight},1E3)}},music_info_change(){this.m_num++}},created(){const a=this;$.getJSON("/get_data?url="+e+"&where=lyric",function(b){a.play_icon_flag=b.data.play_});a.get_music_info(a);setInterval(()=>{a.get_music_info(a)},5E3)}})};
