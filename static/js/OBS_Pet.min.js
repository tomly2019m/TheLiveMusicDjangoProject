class OBS_Pet{constructor(a){this.is_reverse=this.is_playing_animation=this.is_playing_function=!1;this.vue_object=new Vue({el:a,data:{debug_flag:!1,debug_font_size:25,is_playing_function:!1,is_playing_animation:!1,is_reverse:!1,now_called:"",now_image:"statics/images/shime1.png",speed:0,x_pos:300,y_pos:0,win_width:window.innerWidth,win_height:window.innerHeight,final_y:0,status:"stand",flip:"",timer_id:0,motions:{stand:[1],walk:[1,2,1,3],fall:[4],lean_on_right:[5],lean_on_left:[6],drag2right:[7],
drag2left:[8],strong_drag2right:[9],strong_drag2left:[10],sit:[11],climb:[12],climb_first:[13],climb_left_stop:[14,14,12,13],climb_left:[13,13,12,14],sing:[15,16,17],fall_down:[18],prostrate:[20,21],climb_right2left:[23,24,25],celebrate:[26],cry_stand:[34],cry_walk:[35,36]}}})}async play_animation(a,b=1,c=!1){let d=0;for(;!this.break_playing&&(d<b||c)&&!this.break_playing;){this.vue_object.$data.status=a;for(const e of this.vue_object.$data.motions[a])this.break_playing||await this.delayTime(300).then(()=>
{this.vue_object.$data.now_image=`statics/images/shime${e}.png`;console.log(`statics/images/shime${e}.png`);d++})}this.break_playing=!1}play_animation_new(a,b=1,c=!1,d=!1){let e=0;const g=this.vue_object.$data.motions[a],h=g.length,k=document.getElementById("role_image");let f=d?h-1:0;this.vue_object.$data.status=a;this.vue_object.$data.timer_id=setInterval(()=>{this.is_playing_animation=this.vue_object.$data.is_playing_animation=!0;k.setAttribute("src",`statics/images/shime${g[f]}.png`);d?(f--,0>=
f&&(f=g.length-1,e++)):(f++,f===g.length&&(f=0,e++));e<b||c||(clearInterval(this.vue_object.$data.timer_id),this.is_playing_animation=this.vue_object.$data.is_playing_animation=!1)},250);this.break_playing=!1}break_now_and_play(a,b=1,c=0,d=!1){clearInterval(this.vue_object.$data.timer_id);this.play_animation_new(a,b,d,this.is_reverse);0!==c&&setTimeout(()=>{clearInterval(this.vue_object.$data.timer_id);this.is_playing_animation=this.vue_object.$data.is_playing_animation=!1},c)}async delayTime(a){return new Promise((b,
c)=>{setTimeout(()=>{b("\u5ef6\u8fdf")},a)})}random_pos(a){let b;switch(a){case "x":b=Math.random()*window.innerWidth;break;case "y":b=Math.random()*window.innerHeight}this.set_pos(a,b)}set_pos(a,b,c=!0){let d;switch(a){case "x":d=this.vue_object.$data.x_pos-b;this.flip_role(0>d?"right":"left");c=c?b>window.innerWidth-128?window.innerWidth-128:b:b;this.vue_object.$data.x_pos=c;break;case "y":d=this.vue_object.$data.y_pos-b,this.is_reverse=this.vue_object.$data.is_reverse=0<d,c=c?b>window.innerHeight-
128?window.innerHeight-128:b:b,this.vue_object.$data.y_pos=c}this.vue_object.$data.speed=Math.abs(d)/20;console.log(`random_${a}: ${b}, speed: ${this.vue_object.$data.speed}, ${a}_pos: ${this.vue_object.$data[`${a}_pos`]}, ${1E3*this.vue_object.$data.speed}ms`)}flip_role(a){switch(a){case "climb-left":this.vue_object.$data.flip="transform: rotate(90deg)";break;case "climb-right":this.vue_object.$data.flip="transform: rotate(-90deg)";break;case "climb-top-right":this.vue_object.$data.flip="transform: rotate(270deg)";
break;case "climb-top-left":this.vue_object.$data.flip="transform: rotate(270deg) rotateY(180deg)";break;case "left":this.vue_object.$data.flip="";break;case "right":this.vue_object.$data.flip="transform: rotateY(180deg)"}}random_climb_left(){this.vue_object.$data.now_called="random_climb_left";this.random_climb("left")}random_climb(a){this.vue_object.$data.is_playing_function=this.is_playing_function=!0;0===this.vue_object.y_pos?this.break_now_and_play("walk",1,0,!0):this.vue_object.$data.speed=
0;setTimeout(()=>{this.set_pos("x","left"===a?-64:window.innerWidth-64,!1);setTimeout(()=>{let b="left"===a?a:this.flip_role("right");this.break_now_and_play("climb");setTimeout(()=>{let c=Math.random()*window.innerHeight;c=c>window.innerHeight-128?window.innerHeight-128:c;console.log(c);let d=this.vue_object.$data.y_pos-c;this.vue_object.$data.final_y=Math.abs(d);this.is_reverse=this.vue_object.$data.is_reverse=0<d;let e=~~(Math.abs(d)/20);b=!1;let g=setInterval(()=>{b&&this.break_now_and_play("climb_left_stop");
setTimeout(()=>{this.break_now_and_play("climb_left");setTimeout(()=>{this.vue_object.$data.speed=.5;this.vue_object.$data.y_pos=0>d?this.vue_object.$data.y_pos+20:this.vue_object.$data.y_pos-20;e--;b=!0},600);0>=e&&(clearInterval(g),this.break_now_and_play("climb"),this.vue_object.$data.is_playing_function=this.is_playing_function=!1,this.vue_object.$data.now_called="")},2E3)},3E3)},500)},1E3*this.vue_object.$data.speed)},520)}random_climb_right(){this.vue_object.$data.now_called="random_climb_right";
this.random_climb("right")}random_walk(){this.vue_object.$data.now_called="random_walk";this.vue_object.$data.is_playing_function=this.is_playing_function=!0;0!==this.vue_object.y_pos?(this.break_now_and_play("climb_left",1,0,!0),this.set_pos("y",0)):this.vue_object.$data.speed=0;setTimeout(()=>{this.break_now_and_play("walk",1,0,!0);this.random_pos("x");setTimeout(()=>{this.break_now_and_play("stand");this.vue_object.$data.is_playing_function=this.is_playing_function=!1;this.vue_object.$data.now_called=
""},1E3*this.vue_object.$data.speed)},1E3*this.vue_object.$data.speed)}random_sit(){this.vue_object.$data.now_called="random_sit";this.vue_object.$data.is_playing_function=this.is_playing_function=!0;0!==this.vue_object.y_pos?(this.break_now_and_play("climb_left",1,0,!0),this.set_pos("y",0)):this.vue_object.$data.speed=0;setTimeout(()=>{this.break_now_and_play("walk",1,0,!0);this.random_pos("x");setTimeout(()=>{this.break_now_and_play("sit");this.vue_object.$data.is_playing_function=this.is_playing_function=
!1;this.vue_object.$data.now_called=""},1E3*this.vue_object.$data.speed)},1E3*this.vue_object.$data.speed)}random_sing(){this.vue_object.$data.now_called="random_sing";this.vue_object.$data.is_playing_function=this.is_playing_function=!0;0!==this.vue_object.y_pos?(this.break_now_and_play("climb_left",1,0,!0),this.set_pos("y",0)):this.vue_object.$data.speed=0;setTimeout(()=>{this.break_now_and_play("walk",1,0,!0);this.random_pos("x");setTimeout(()=>{this.break_now_and_play("sing",10);setTimeout(()=>
{this.break_now_and_play("stand");this.vue_object.$data.is_playing_function=this.is_playing_function=!1;this.vue_object.$data.now_called=""},7E3)},1E3*this.vue_object.$data.speed)},1E3*this.vue_object.$data.speed)}random_prostrate(){this.vue_object.$data.now_called="random_prostrate";this.vue_object.$data.is_playing_function=this.is_playing_function=!0;0!==this.vue_object.y_pos?(this.break_now_and_play("climb_left",1,0,!0),this.set_pos("y",0)):this.vue_object.$data.speed=0;setTimeout(()=>{this.is_reverse=
!1;this.break_now_and_play("prostrate",1,0,!0);this.random_pos("x");setTimeout(()=>{this.break_now_and_play("prostrate");this.vue_object.$data.is_playing_function=this.is_playing_function=!1;this.vue_object.$data.now_called=""},1E3*this.vue_object.$data.speed)},1E3*this.vue_object.$data.speed)}};
