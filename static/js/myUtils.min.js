class MyUtils{constructor(){this.n=0;this.last="";this.global_time=this.is_play=0;this.global_time_flag=!0;this.global_time_break_flag=!1;this.htmlAudioElement=new Audio("")}load_QRCode_b64(a){let b=a.$data.QRCode_key,c={qq:"qq-music-qr-code",ku_wo:"ku-wo-music-qr-code",cloud:"cloud-music-qr-code"};a.$data.QRCode_b64_style="";a.$data.QRCode_load_flag=!0;a.$data.QRCode_login_status[b]?(a.$data.QRCode_load_flag=!1,a.$data.QRCode_b64_style=""):$.getJSON(c[b],{secret:a.$data.secret},async d=>{a.$data.QRCode_b64_style=
"background-image: url(data:image/jpg;base64,"+d.base64+");";a.$data.QRCode_load_flag=!1;for(d=0;20>d;d++)if(await this.delayTime(5E3),this.get_login_status(a),a.$data.QRCode_login_status[b]||!a.$data.login_mask){a.$data.login_mask=!1;a.$data.QRCode_key="";a.$data.QRCCode_selected_style[b]="";break}})}get_login_status(a){let b=a.$data.QRCode_key;$.getJSON("get-qr-status",{secret:a.$data.secret},c=>{console.log(c);a.$data.QRCode_login_status=c;a.$data.QRCode_login_status[b]&&(a.$data.QRCode_b64_style=
"")})}set_login_status(a){$.getJSON("set-qr-status",{secret:a.$data.secret,platform:a.$data.QRCode_key,value:!1},b=>{console.log(b);b.data&&(a.$data.QRCode_login_status[a.$data.QRCode_key]=!1,this.load_QRCode_b64(a))})}change_QRCode(a,b){a.$data.QRCode_key=b;a.$data.QRCCode_selected_style={qq:"",cloud:"",ku_wo:""};a.$data.QRCCode_selected_style[b]="background-color: #b5b5b5;";a.$data.QRCode_where={qq:"QQ\u97f3\u4e50",cloud:"\u7f51\u6613\u4e91\u97f3\u4e50",ku_wo:"\u9177\u6211\u97f3\u4e50"}[b];this.load_QRCode_b64(a)}show_logged(a){}change_display_css(a){console.log("\u4e3b\u9898 "+
a.$data.theme_id);a.$data.set_flag||(a.$data.display_style="border: none;box-shadow: none;");a.$data.display_style+="width: "+a.$data.v_div_width+"px; height: "+a.$data.v_div_height+'px; border-image: url("'+a.$data.theme_url[a.$data.theme_id]+'") stretch; border-image-slice: '+a.$data.border_image_slice[a.$data.theme_id]+" fill; border-image-width: "+a.$data.border_image_width[a.$data.theme_id]+"px; border-image-outset: "+a.$data.border_image_outset[a.$data.theme_id]+"px;"}change_first_css(a){a.$data.first_style=
"font-family: "+a.$data.v_first_font+"; font-size: "+a.$data.v_first_font_size+"px; color: "+a.$data.v_first_color+"; text-shadow: "+this.generate_text_shadow(a.$data.first_shadow_blur,a.$data.first_shadow_color,a.$data.first_shadow_num)}change_second_css(a){a.$data.second_style="font-family: "+a.$data.v_second_font+"; font-size: "+a.$data.v_second_font_size+"px; color: "+a.$data.v_second_color+"; text-shadow: "+this.generate_text_shadow(a.$data.second_shadow_blur,a.$data.second_shadow_color,a.$data.second_shadow_num)}change_now_css(a){a.$data.now_style=
"font-family: "+a.$data.v_now_font+"; font-size: "+a.$data.v_now_font_size+"px; color: "+a.$data.v_now_color+"; text-shadow: "+this.generate_text_shadow(a.$data.now_shadow_blur,a.$data.now_shadow_color,a.$data.now_shadow_num)}generate_text_shadow(a,b,c){c=parseInt(c);a=parseInt(a);if(0===c)return"";let d=[];for(let e=-c;e<=c;e+=Math.ceil(c/4))for(let f=-c;f<=c;f+=Math.ceil(c/4))d.push(e+"px "+f+"px "+a+"px "+b);return d.join(",")+";"}change_li_css(a){a.$data.li_style="margin: 0 0 "+a.$data.v_li_margin+
"px 0;";console.log(this.global_time_break_flag);this.global_time_break_flag||this.test_lyric(a);this.global_time_break_flag=!0}change_theme(a,b){a.$data.theme_id=parseInt(b)}use_get(a,b){let c,d={where:b,secret:a.$data.secret,theme_id:a.$data.theme_id,black_user_list:JSON.stringify(a.$data.black_user_list),div_width:a.$data.v_div_width,div_height:a.$data.v_div_height,v_li_margin:a.$data.v_li_margin};switch(b){case "music":c={music_color:a.$data.v_first_color,music_font:a.$data.v_first_font,music_font_size:a.$data.v_first_font_size,
artist_color:a.$data.v_second_color,artist_font:a.$data.v_second_font,artist_font_size:a.$data.v_second_font_size,music_shadow_num:a.$data.first_shadow_num,music_shadow_blur:a.$data.first_shadow_blur,music_shadow_color:a.$data.first_shadow_color,artist_shadow_num:a.$data.second_shadow_num,artist_shadow_blur:a.$data.second_shadow_blur,artist_shadow_color:a.$data.second_shadow_color};break;case "lyric":c={original_text_color:a.$data.v_first_color,original_text_font:a.$data.v_first_font,original_text_font_size:a.$data.v_first_font_size,
translation_color:a.$data.v_second_color,translation_font:a.$data.v_second_font,translation_font_size:a.$data.v_second_font_size,now_color:a.$data.v_now_color,now_font:a.$data.v_now_font,now_font_size:a.$data.v_now_font_size,original_shadow_num:a.$data.first_shadow_num,original_shadow_blur:a.$data.first_shadow_blur,original_shadow_color:a.$data.first_shadow_color,translation_shadow_num:a.$data.second_shadow_num,translation_shadow_blur:a.$data.second_shadow_blur,translation_shadow_color:a.$data.second_shadow_color,
now_shadow_num:a.$data.now_shadow_num,now_shadow_blur:a.$data.now_shadow_blur,now_shadow_color:a.$data.now_shadow_color}}b={...d,...c};console.log(b);$.ajaxSettings.timeout="3000";$.get("/from-bili?",b,(e,f)=>{switch(f){case "success":this.change_load_info(a,!0,"sus");break;default:this.change_load_info(a,!0,"fail",f)}})}use_get_global(a,b){$.get("/add-global-setting",{secret:a.$data.secret,where:b,data:JSON.stringify("black_user_list"===b?a.$data.black_user_list:a.$data.black_music_list)})}push_black(a,
b){const c={music:{music_name:a.$data.black_music.music_name,artist:a.$data.black_music.artist},user:{nick:a.$data.black_user.nick,uid:a.$data.black_user.uid}},d={music:["music_name","artist"],user:["nick","uid"]};null==c[b][d[b][0]]&&null==c[b][d[b][1]]?console.log("\u65e0\u5185\u5bb9"):(a.$data["black_"+b+"_list"].push(c[b]),a.$data["black_"+b]={},a.$data.mask1_1=!1,a.$data.mask2_1=!1)}sumV2(a,b){return[...(new Set([...a,...b]))]}create_time_list(a){let b=0,c=[],d=[];const e=document.getElementsByClassName("item"),
f=e.length;if("lyric"===a){for(;b<f;){console.log(b);try{a=[],a[0]=e[b].id,a[1]=e[b+1].id,c[b]=a,b++}catch(h){a=[];a[0]=e[b].id;a[1]="86400";c[b]=a;break}}d[0]=e[b].id;d[1]="86400";c[b]=d;console.log(c)}return{lis_len:f,time_list:c}}show_now_lyric(a,b,c,d){if(a<b&&parseFloat(c[a][0])<=d&&d<=parseFloat(c[a][1])+1){b=document.getElementsByClassName("item");for(let e of b)e.getElementsByClassName("original")[0].style.cssText=vm.$data.first_style;document.getElementById(c[a][0]).getElementsByClassName("original")[0].style.cssText=
vm.$data.now_style;this.change(vm);a++}return a}music_play(a,b,c){let d=0;const e=this,{lis_len:f,time_list:h}="lyric"===c&&this.create_time_list(c);"lyric"===c&&(this.n=3*(parseInt(a.$data.v_li_margin)+parseInt(a.$data.li_height)),this.change(a));this.htmlAudioElement=new Audio(b);this.htmlAudioElement.play().then(()=>{this.is_play=1;console.log(this);console.log(this.is_play)});this.htmlAudioElement.addEventListener("timeupdate",function(){"lyric"===c&&(d=e.show_now_lyric(d,f,h,this.currentTime))});
this.htmlAudioElement.addEventListener("ended",()=>{$.get("/next_music",{url:a.$data.url,where:c})})}music_play1(a,b){let c=0;const {lis_len:d,time_list:e}="lyric"===b&&this.create_time_list(b);"lyric"===b&&(this.n=3*(parseInt(a.$data.v_li_margin)+parseInt(a.$data.li_height)),this.change(a));this.htmlAudioElement.play().then(()=>{this.is_play=1;console.log(this);console.log(this.is_play)});this.htmlAudioElement.ontimeupdate=()=>{"lyric"===b&&(c=this.show_now_lyric(c,d,e,this.htmlAudioElement.currentTime))};
this.htmlAudioElement.onended=()=>{this.is_play=0;$.get("/next_music",{url:a.$data.url,where:b})}}change(a){this.n-=90+parseInt(a.$data.v_li_margin);document.getElementById("uls").style.transform="translateY("+this.n+"px)"}get_base_control(a,b){return{which_data_list:["replay","who_play","play_status"],callback_list:[b.base_control]}}get_music_info_list(a,b){return{which_data_list:["music_name_list"],callback_list:[b.music_info_list_control]}}get_music_url(a,b){return{which_data_list:["now_music_url"],
callback_list:[b.music_url_control]}}get_lyric(a,b){return{which_data_list:["lyric_name"],callback_list:[b.lyric_control]}}get_is_running(a,b){return{which_data_list:["is_running"],callback_list:[b.is_running_control]}}get_console_info(a,b){return{which_data_list:["console_info"],callback_list:[b.console_info_control]}}get_who_play(a,b){return{which_data_list:["who_play"],callback_list:[b.who_play_control]}}base_control(a,b,c){console.log(c);a.$data.who_play=c.who_play;let d=c.who_play===a.$data.who_i_am;
console.log(`is_play: ${b.is_play}`);const e=0===c.who_play?"music":"lyric";c.play_status&&!b.is_play&&d?b.music_play1(a,e):!c.play_status&&b.is_play&&d&&(b.htmlAudioElement.pause(),b.is_play=0);c.replay&&d&&(b.htmlAudioElement.load(),b.music_play1(a,e),$.get("play",{url:a.$data.url,data:0,where:"replay",where_url:`${a.$data.who_i_am?"lyric":"music"}_url`}))}music_info_list_control(a,b,c){console.log(c);c=c.music_name_list;const d=c[0],e=[];c.forEach(f=>{e.push(f.file_name)});a.$data.music_info=e;
void 0!==d&&void 0!==d.file_name?b.is_empty(d.file_name[0])?$.get("/next_music",{url:a.$data.url,where:a.$data.who_i_am?"lyric":"music"}):a.$data.now_music_name=d.file_name.join(", "):(a.$data.music_info=[["\u6682\u65e0\u6b4c\u66f2","\u65e0"]],a.$data.now_music_name="",b.htmlAudioElement.src="",b.is_play=0)}lyric_control(a,b,c){console.log(c);let d=c.lyric_name,e;try{e=d[0].id}catch(f){e=null}b.is_empty(e)?a.$data.lyric_info=[{id:0,original:"\u6682\u65e0\u6b4c\u8bcd",translation:"no find lyric"}]:
(b.is_has_field({A:{a:"b"}},"a"),a.$data.lyric_info=c.lyric_name)}music_url_control(a,b,c){console.log(c);b.htmlAudioElement.pause();b.htmlAudioElement.src=c.now_music_url;""===c.now_music_url&&$.get("/next_music",{url:a.$data.url,where:0===c.who_play?"music":"lyric"});b.is_play=0}is_running_control(a,b,c){b=c.is_running;console.log(b);b?(a.$data.start_flag=!0,a.$data.start_getting_text="\u505c\u6b62\u7edf\u8ba1"):(a.$data.start_flag=!1,a.$data.start_getting_text="\u5f00\u59cb\u7edf\u8ba1")}who_play_control(a,
b,c){a=c.who_play;console.log(a);a?$("[name='switch']:eq(0)").prop("checked",!1):$("[name='switch']:eq(0)").prop("checked",!0)}console_info_control(a,b,c){b=c.console_info;console.log(b);a.$data.console_info=b}get_data(a,b,c,d){$.getJSON("get_data",{url:a.$data.url,where:a.$data.who_i_am?"lyric":"music",which_data:JSON.stringify(c)},e=>{d.forEach(f=>{f(a,b,e)})})}get_union_data(a,b,c){let d=[],e=[];c.forEach(f=>{f=f(a,b);d=[...d,...f.callback_list];e=[...e,...f.which_data_list]});this.get_data(a,
b,e,d)}is_empty(a){try{return""===a.trim()}catch(b){return null===a||void 0===a}}is_has_field(a,b){let c=!1;if("object"===typeof a)for(const d in a){if(d===b){c=!0;break}if(a[d]===b){c=!0;break}c=this.is_has_field(a[d],b)}return c}from_sever_get_data(a,b){$.getJSON("/get_data",{url:a.$data.url,where:b},c=>{console.log(this.is_play);this.do_some_command(a,c,b)})}do_some_command(a,b,c){console.log(b);console.log(this.last);let d;const e=b.data.play_,f=b.data.replay,h=b.data.lyric_name,k=b.data.is_running,
l=b.data.now_music_url,m=b.data.music_name_list,n=b.data.global_setting,g=b.data.user_set;switch(c){case "lyric":a.$data.theme_id=parseInt(g.theme_id);a.$data.v_div_width=parseInt(g.div_width);a.$data.v_div_height=parseInt(g.div_height);a.$data.v_first_color=g.original_text_color;a.$data.v_first_font=g.original_text_font;a.$data.v_first_font_size=parseInt(g.original_text_font_size);a.$data.v_second_color=g.translation_color;a.$data.v_second_font=g.translation_font;a.$data.v_second_font_size=parseInt(g.translation_font_size);
a.$data.v_now_color=g.now_color;a.$data.v_now_font=g.now_font;a.$data.v_now_font_size=parseInt(g.now_font_size);a.$data.v_li_margin=g.v_li_margin;a.$data.now_shadow_num=parseInt(g.now_shadow_num);a.$data.now_shadow_blur=parseInt(g.now_shadow_blur);a.$data.now_shadow_color=g.now_shadow_color;a.$data.first_shadow_num=parseInt(g.original_shadow_num);a.$data.first_shadow_blur=parseInt(g.original_shadow_blur);a.$data.first_shadow_color=g.original_shadow_color;a.$data.second_shadow_num=parseInt(g.translation_shadow_num);
a.$data.second_shadow_blur=parseInt(g.translation_shadow_blur);a.$data.second_shadow_color=g.translation_shadow_color;break;case "music":a.$data.theme_id=parseInt(g.theme_id),a.$data.v_div_width=parseInt(g.div_width),a.$data.v_div_height=parseInt(g.div_height),a.$data.v_first_color=g.music_color,a.$data.v_first_font=g.music_font,a.$data.v_first_font_size=parseInt(g.music_font_size),a.$data.v_second_color=g.artist_color,a.$data.v_second_font=g.artist_font,a.$data.v_second_font_size=parseInt(g.artist_font_size),
a.$data.v_li_margin=parseInt(g.v_li_margin),a.$data.first_shadow_num=parseInt(g.music_shadow_num),a.$data.first_shadow_blur=parseInt(g.music_shadow_blur),a.$data.first_shadow_color=g.music_shadow_color,a.$data.second_shadow_num=parseInt(g.artist_shadow_num),a.$data.second_shadow_blur=parseInt(g.artist_shadow_blur),a.$data.second_shadow_color=g.artist_shadow_color}a.$data.who_play=b.data.who_play;a.$data.black_user_list=n.black_user_list;a.$data.black_music_list=n.black_music_list;b=[{id:0,original:"\u6682\u65e0\u6b4c\u8bcd",
translation:"no find lyric"}];try{a.$data.lyric_info=null!=h[0].id?h:b,a.$data.music_url=l,a.$data.stop_flag=k}catch(p){a.$data.lyric_info=b,a.$data.music_url=l,a.$data.stop_flag=k}console.log(m);try{d=JSON.parse(JSON.stringify([m[0]]))}catch(p){d=[]}!d.equals([void 0])&&!d.equals([["",""]])||m.equals([])||(d=[],$.get("/next_music",{url:a.$data.url,where:c}));console.log("vm.now_music_name: "+a.$data.now_music_name);console.log("now_music_name: "+d);e&&!this.is_play&&("music"===c?0===a.$data.who_play:
1===a.$data.who_play)&&this.htmlAudioElement.play().then(()=>{this.is_play=1});switch(c){case "music":a.$data.who_play&&this.is_play&&(this.htmlAudioElement.pause(),this.is_play=0);m.equals([])&&(console.log("\u6682\u65e0\u6b4c\u66f2"),a.$data.music_info=[["\u6682\u65e0\u6b4c\u66f2","\u65e0"]],console.log(a.$data.music_info));break;case "lyric":!a.$data.who_play&&this.is_play&&(this.htmlAudioElement.pause(),this.is_play=0)}f&&this.is_play&&($.get("/play",{url:a.$data.url,data:0,where:"replay",where_url:c+
"_url"}),this.htmlAudioElement.load(),this.htmlAudioElement.play().then(()=>{this.is_play=1}),this.n=2*(parseInt(a.$data.v_li_margin)+parseInt(a.$data.li_height)),this.change(a));e||(this.htmlAudioElement.pause(),this.is_play=0);a.$data.now_music_name=d.join(",");m.equals([])?a.$data.music_info=[["\u6682\u65e0\u6b4c\u66f2","\u65e0"]]:a.$data.music_info=m}prepare_to_music_play(a,b,c){let d=a.$data.now_music_name;this.htmlAudioElement.pause();if(""===d)$.get("/next_music",{url:a.$data.url,where:c}),
"lyric"===c&&(this.n=2*(parseInt(a.$data.v_li_margin)+parseInt(a.$data.li_height)),this.change(a));else{try{this.htmlAudioElement.pause(),this.is_play=0}catch(e){console.log()}switch(c){case "music":setTimeout(()=>{("music"===c?0===a.$data.who_play:1===a.$data.who_play)&&this.music_play(a,b,"music")},2E3);break;case "lyric":setTimeout(()=>{("music"===c?0===a.$data.who_play:1===a.$data.who_play)&&this.music_play(a,b,"lyric")},2E3)}}}async delayTime(a){return new Promise((b,c)=>{setTimeout(()=>{b("\u5ef6\u8fdf")},
a)})}test_music(a){a.$data.test_flag<a.$data.music_info_test.length-1?(a.$data.music_info[a.$data.test_flag]=a.$data.music_info_test[a.$data.test_flag],console.log(a.$data.test_flag),console.log(a.$data.music_info),a.$data.test_flag++):clearInterval()}async test_lyric(a){let b=0,c=0;this.n=2*(parseInt(a.$data.v_li_margin)+parseInt(a.$data.li_height));const d=[[2,6],[6,8],[8,11],[11,14],[14,15],[15,20],[20,25],[25,30],[30,35],[35,40],[40,45],[45,50],[50,55],[55,60],[60,65],[65,70],[70,75],[75,80],
[80,85],[85,90],[90,95],[95,100],[100,105],[105,110],[110,115],[115,120],[120,125],[125,130],[130,135],[135,140],[140,145],[145,150]];for(let e=0;155>e;e++){await this.delayTime(1E3);if(this.global_time_break_flag)break;console.log(e);b=this.show_now_lyric(b,d.length,d,c);c++}this.global_time_break_flag||await this.test_lyric(a);this.global_time_break_flag=!1}async delay_timer(a,b,c){for(;0<b;b--)b=this.global_time--,console.log(b),await this.delayTime(1E3);this.use_get(a,c);this.global_time_flag=
!0}delay_post_setting(a,b,c){this.global_time=b;this.global_time_flag&&(this.change_load_info(a,!0,"load"),this.delay_timer(a,b,c).then(()=>{}));this.global_time_flag=!1}reset_own_database(a,b){$.getJSON("/reset_own_database",{where_url:b,url:a.$data.url},c=>{c?a.$data.mask2_1=!0:a.$data.mask2_2=!0})}copy_content(a,b,c){navigator.clipboard.writeText(c).then(d=>{console.log(d);console.log("\u590d\u5236\u6210\u529f");this.change_load_info(a,!0,"copy_sus")}).catch(d=>{console.log(d);$(b).select();try{document.execCommand("copy"),
this.change_load_info(a,!0,"copy_sus")}catch(e){this.change_load_info(a,!0,"copy_fail")}})}change_load_info(a,b,c,d=""){a.$data.load_info_flag=b;switch(c){case "sus":a.$data.load_info_icon="check";a.$data.load_info="\u8bbe\u7f6e\u5df2\u4fdd\u5b58";break;case "fail":a.$data.load_info_icon="close";a.$data.load_info="\u63d0\u4ea4\u5931\u8d25 \u539f\u56e0: "+d;break;case "load":a.$data.load_info_icon="loading";a.$data.load_info="\u6b63\u5728\u63d0\u4ea4\u8bbe\u7f6e\uff0c\u8bf7\u52ff\u5207\u6362\u9875\u9762";
break;case "copy_sus":a.$data.load_info_icon="check";a.$data.load_info="\u5df2\u590d\u5236\u5230\u526a\u5207\u677f";break;case "copy_fail":a.$data.load_info_icon="close",a.$data.load_info="\u590d\u5236\u5931\u8d25"}c&&this.delayTime(3E3).then(()=>{this.change_load_info(a,!1,"")})}get_qq_playlist(a){$.getJSON("get-qq-playlist",{url:a.$data.url,where_url:a.$data.who_i_am?"lyric_url":"music_url"},b=>{console.log(b);b=b.data.disslist;for(let c=1;c<b.length;c++){const d=b[c];console.log("list_name: %s, id: %s",
d.diss_name,d.tid);a.$data.playlist_name.push({tid:d.tid,name:d.diss_name,song_count:d.song_cnt,platform_text:"QQ\u97f3\u4e50",platform:"qq",cover:"?n=1"===d.diss_cover?"":d.diss_cover})}})}get_qq_playlist_info(a){$.getJSON("get-qq-playlist-info",{playlist_id:a.$data.playlist_id},b=>{console.log(b)})}load_playlist_to_database(a){setTimeout(()=>{$.getJSON("load-playlist-to-database",{url:a.$data.url,where_url:`${a.$data.where}_url`,platform:a.$data.playlist_platform,overwrite:a.$data.playlist_overwrite,
playlist_id:a.$data.playlist_id})},1E3)}start_getting(a){let b={url:a.$data.url,where:a.$data.where};a.$data.start_flag?(b.data=0,$.get("start_dan_mu",b,c=>{"id"!==c.data&&"key"!==c.data&&(a.$data.start_getting_text="\u5f00\u59cb\u7edf\u8ba1",a.$data.start_flag=!1)})):(b.data=1,$.getJSON("start_dan_mu",b,c=>{"id"!==c.data&&"key"!==c.data&&(a.$data.start_getting_text="\u505c\u6b62\u7edf\u8ba1",a.$data.start_flag=!0)}))}change_who_play(a){const b=$("[name='switch']:eq(0)").prop("checked");console.log(b);
$.get("play",{url:a.$data.url,data:Number(!b),where:"who_play",where_url:`${a.$data.where}_url`})}play_pause(a){a.$data.play_icon_flag=a.$data.play_icon_flag?0:1;$.get("play",{url:a.$data.url,data:a.$data.play_icon_flag,where:"play",where_url:`${a.$data.where}_url`})}replay_music(a){$.get("play",{url:a.$data.url,data:1,where:"replay",where_url:`${a.$data.where}_url`})}next_music(a){$.get("next_music",{url:a.$data.url,where:a.$data.where})}delete_music(a,b,c,d){$.get("del_music",{url:a.$vm.url,data:a.$vm.play_icon_flag,
artist:d,where_url:`${a.$vm.where}_url`,music_name:c})}move_music(a,b,c,d,e){$.get("move_music",{url:a.$vm.url,data:a.$vm.play_icon_flag,index:e,artist:d,where_url:`${a.$vm.where}_url`,music_name:c})}display_operation(a){$(a).css("display","flex")}hidden_operation(a){$(a).css("display","none")}change_bili_scroll_flag(a,b){a.$data.scroll_flag=b}get_music_info(a){$.getJSON("/get_data",{url:a.$data.url,where:a.$data.where},b=>{console.log(b);var c=b.data.music_name_list,d=b.data.who_play;const e=b.data.is_running;
a.$data.console_info=b.data.console_info;a.$data.play_icon_flag=b.data.play_;try{var f=[c.shift()]}catch(h){f=[]}f.equals([void 0])&&(f=[]);d?$("[name='switch']:eq(0)").prop("checked",!1):$("[name='switch']:eq(0)").prop("checked",!0);e?($("#start_dan_mu").text("\u505c\u6b62\u7edf\u8ba1"),a.$data.start_flag=!0):($("#start_dan_mu").text("\u5f00\u59cb\u7edf\u8ba1"),a.$data.start_flag=!1);c.equals(a.$data.last_list)||(a.$data.last_list=c,a.$data.music_list=c);if(!f.equals(a.$data.last)){a.$data.last=
f;b=a.$data.last.equals([])||a.$data.last.equals([["",""]])?'<li><span class="music-name">\u6682\u65e0\u6b4c\u66f2</span><span class="artist">\u6682\u65e0</span></li>':'<li><span class="music-name">'+f[0][0]+'</span><span class="artist">'+f[0][1]+"</span></li>";f=document.getElementById("u");c=f.childNodes;for(d=c.length-1;0<=d;d--)f.removeChild(c[d]);f.innerHTML=b}})}on_wss(a,b,c){if("LIVE_OPEN_PLATFORM_DM"===a.cmd){const d=c[0],e=c[1];c=c[2];let {music_name:f,artist:h,status:k}=b.my_filter(d,a);
d.$data.start_flag&&k&&("music_url"===c?0===d.$data.who_i_am:1===d.$data.who_i_am)?b.send_to_server(f,h,e,c):console.log("stop\n"+f+": "+h)}}my_filter(a,b){let c=b.data.uid,d=b.data.uname;b=b.data.msg.split("#")[0].split(" ");var e=b.shift();let f,h;console.log("comment: "+b+"\ncommand: "+e);if("\u70b9\u6b4c"===e||"."===e){e=!0;b=b.join(" ");b=b.split("&");void 0===b[1]&&(b=b[0].split("\uff06"));console.log(b);f=$.trim(b[0]);h=$.trim(b[1]);console.log("music_name: "+f+"\nartist: "+h);for(const k of a.$data.black_user_list){try{switch(c){case parseInt(k.uid):e=
!1}}catch(l){console.log("no uid")}try{switch(d.toUpperCase()){case k.nick:e=!1}}catch(l){console.log("no uname")}}for(const k of a.$data.black_music_list){try{switch(f.toUpperCase()){case k.music_name.toUpperCase():e=!1}}catch(l){}try{switch(h.toUpperCase()){case k.artist.toUpperCase():e=!1}}catch(l){}}}else e=!1;return{music_name:f,artist:h,status:e}}send_to_server(a,b,c,d){$.get("move_music",{index:-1,url:c,artist:b,where_url:d,music_name:a})}};
